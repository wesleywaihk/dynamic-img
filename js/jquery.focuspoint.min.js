/**
 * jQuery FocusPoint; version: v2-dev
 * Author: J. Menz http://jonathonmenz.com
 * Source: https://github.com/jonom/jquery-focuspoint
 * Copyright (c) 2014 - 2016 J. Menz; License TBC
 * @preserve
 */
!function($,i,t,a){function e(i,t){this.element=i,this.settings=$.extend({},n,t),this.init()}var n={reCalcOnWindowResize:!0,setTransformOrigin:!0,legacyGrid:!1},s=$(),o=function(i,t,a){var e;return function(){var n=this,s=arguments,o=function(){e=null,a||i.apply(n,s)},r=a&&!e;clearTimeout(e),e=setTimeout(o,t),r&&i.apply(n,s)}},r=!1,c=function(){r||(r=!0,g(),p())},p=o(function(){r=!1},250),g=function(){s.focusPoint("adjustFocus"),r&&(i.requestAnimationFrame?i.requestAnimationFrame(g):setTimeout(g,1e3/15))},h=function(){$(i).off("resize.focuspoint"),s.length&&$(i).on("resize.focuspoint",c)},l=function(i,t){return i-t},m=function(i,t){var a=t-1;if(0>a)return.5*(1-t);if(a>0){var e=-1*a,n=.5-i*t;return n>0?0:0>n&&e>n?e:n}return 0},f=function(i,t,a){var e=t.split(","),n=[];return $.each(e,function(t,n){e[t]=parseFloat(n.trim()),a===!0&&("X"===i?e[t]=.5*(e[t]+1):e[t]=(e[t]-1)*-.5)}),e.length>1?(e.sort(l),n.start=e[0],n.stop=e[1],n.average=(e[0]+e[1])/2):n.start=n.stop=n.average=e[0],n.maxScale=1/(n.stop-n.start),n};$.extend(e.prototype,{init:function(){if(this.$el=$(this.element),this.$image=this.$el.find("img, video").first(),this.imageW=this.$el.data("imageW"),this.imageH=this.$el.data("imageH"),this.imageRatio=this.imageW/this.imageH,!this.imageW&&!this.imageH)return this.resolveImageSize();var i=this;if($.each(["X","Y"],function(t,a){var e=f(a,String(i.$el.data("focus"+a)),i.settings.legacyGrid);i["focus"+a+"MinStart"]=e.start,i["focus"+a+"MinStop"]=e.stop,i["focus"+a]=e.average,i["minCroppingRegionMaxScale"+a]=e.maxScale,e=f(a,String(i.$el.data("focus"+a+"Ideal")),i.settings.legacyGrid),i["focus"+a+"IdealStart"]=e.start,i["focus"+a+"IdealStop"]=e.stop,i["idealCroppingRegionMaxScale"+a]=e.maxScale}),this.minCroppingRegionW=(this.focusXMinStop-this.focusXMinStart)*this.imageW,this.minCroppingRegionH=(this.focusYMinStop-this.focusYMinStart)*this.imageH,this.minCroppingRegionRatio=this.minCroppingRegionW/this.minCroppingRegionH,this.idealCroppingRegionW=(this.focusXIdealStop-this.focusXIdealStart)*this.imageW,this.idealCroppingRegionH=(this.focusYIdealStop-this.focusYIdealStart)*this.imageH,this.idealCroppingRegionRatio=this.idealCroppingRegionW/this.idealCroppingRegionH,this.settings.setTransformOrigin){var t=100*i.focusX+"% "+100*i.focusY+"%";this.$image.css({"webkit-transform-origin":t,"transform-origin":t})}this.$el.addClass("focuspoint-active"),this.adjustFocus(),this.settings.reCalcOnWindowResize&&this.windowOn()},resolveImageSize:function(){if(this.triedAutoResolution)return!1;this.triedAutoResolution=!0;var i=this.$el;$("<img />").one("load",function(){i.data("imageW",this.width),i.data("imageH",this.height),i.focusPoint("init")}).attr("src",this.$image.attr("src"))},windowOn:function(){s=s.add(this.element),h()},windowOff:function(){s=s.not(this.element),h()},adjustFocus:function(){var i={};return i.containerW=this.$el.width(),i.containerH=this.$el.height(),i.containerW>0&&i.containerH>0&&this.imageW>0&&this.imageH>0?(i.containerRatio=i.containerW/i.containerH,i.containerRatio===this.imageRatio?void this.$image.css({width:"100%",height:"100%",left:0,top:0}):(i.axisScale={X:this.imageRatio/i.containerRatio,Y:i.containerRatio/this.imageRatio},i.containerRatio>=this.idealCroppingRegionRatio&&i.containerRatio<=this.imageW/this.idealCroppingRegionH?(i.clippingMode="ideal",i.primaryClippingAxis="Y",i.secondaryClippingAxis="X"):i.containerRatio<=this.idealCroppingRegionRatio&&i.containerRatio>=this.idealCroppingRegionW/this.imageH?(i.clippingMode="ideal",i.primaryClippingAxis="X",i.secondaryClippingAxis="Y"):this.imageRatio>i.containerRatio?(i.clippingMode="classic",i.primaryClippingAxis="X",i.axisScale.X>this.minCroppingRegionMaxScaleX&&(i.clippingMode="min")):(i.clippingMode="classic",i.primaryClippingAxis="Y",i.axisScale.Y>this.minCroppingRegionMaxScaleY&&(i.clippingMode="min")),i.scale=1,i.shiftPrimary=0,i.shiftSecondary=0,"ideal"===i.clippingMode?(i.scale=this["idealCroppingRegionMaxScale"+i.primaryClippingAxis]/i.axisScale[i.primaryClippingAxis],i.shiftSecondary=100*m(this["focus"+i.secondaryClippingAxis],i.scale)+"%",i.shiftPrimary=-100*this["focus"+i.primaryClippingAxis+"IdealStart"]*i.axisScale[i.primaryClippingAxis]*i.scale+"%"):"min"===i.clippingMode?(i.scale=this["minCroppingRegionMaxScale"+i.primaryClippingAxis]/i.axisScale[i.primaryClippingAxis],i.shiftSecondary=100*m(this["focus"+i.secondaryClippingAxis],i.scale)+"%",i.shiftPrimary=-100*this["focus"+i.primaryClippingAxis+"MinStart"]*i.axisScale[i.primaryClippingAxis]*i.scale+"%"):i.shiftPrimary=100*m(this["focus"+i.primaryClippingAxis],i.axisScale[i.primaryClippingAxis])+"%",void("X"===i.primaryClippingAxis?this.$image.css({width:i.axisScale[i.primaryClippingAxis]*i.scale*100+"%",height:100*i.scale+"%",left:i.shiftPrimary,top:i.shiftSecondary}):this.$image.css({width:100*i.scale+"%",height:i.axisScale[i.primaryClippingAxis]*i.scale*100+"%",left:i.shiftSecondary,top:i.shiftPrimary})))):!1}}),$.fn.focusPoint=function(i){return this.each(function(){$.data(this,"focusPoint")||$.data(this,"focusPoint",new e(this,i))}),"string"==typeof i?this.each(function(){var t=$(this);t.data("focusPoint")[i]()}):this}}(jQuery,window,document);
